# Anchor 文档

## 技术路径
- 最小化事件通过 Tk `Unmap` 监听，检测窗口进入 `iconic` 状态即隐藏窗口。
- Windows 端托盘化时用 `GetWindowLongW/SetWindowLongW` 清除 `WS_EX_APPWINDOW` 并设置 `WS_EX_TOOLWINDOW`，恢复显示时还原扩展样式避免影响 Alt-Tab。
- 托盘功能基于 `pystray` 与 `Pillow`，在后台线程中创建托盘图标与菜单，提供显示窗口与退出入口。
- 托盘图标优先使用仓库的 `app.ico`，缺失时生成纯色占位图避免崩溃。
- 结算机制在 `maybe_rollover_day` 中以 `WORK_END` 为阈值，避免重复结算并将每日收入写入数据文件内的历史字段。
- 数据文件与配置文件迁移至用户本地数据目录（优先 `APPDATA`，否则 `~/.local/share`），启动时自动迁移旧路径数据。

## 修改日志
- v0.1.1 feature: 最小化改为收起至系统托盘，新增托盘菜单可恢复或退出。
- v0.1.2 bugfix: 打包流程补充 pystray/Pillow/pywin32 依赖，修复 EXE 运行缺模块问题。
- v0.1.3 feature: 增加 18:00 日结与历史记录，补偿跨日未结算收入。
- v0.1.4 refactor: 将历史记录合并进数据文件，减少多文件维护成本。
- v0.2.0 feature: 数据与配置落盘到本地用户目录，自动迁移旧版文件路径。
- v0.2.1 bugfix: 修复18点后不应立即清零，改为次日清零。
- v0.2.2 bugfix: 托盘化时移除任务栏/最小化窗口条目，仅保留托盘图标。
- v0.2.3 feature: 增加托盘与右键菜单“详情”，展示近7天摸鱼趋势弹窗。

## 后续规划思考
- 右键菜单可追加“详情”入口，弹窗展示本周摸鱼分布趋势，并预留导出数据按钮。
- 结合 `maybe_rollover_day` 的日期滚动，在每日早间启动时自动清零当日金额并保存前一日记录，确保统计口径清晰。
