# Anchor 文档

## 版本规范
- 版本号采用 `v主.次.修`，并在修改日志中标注 `feature/refactor/bugfix` 类型。

## 技术路径
- 窗口最小化通过 Tk `Unmap` 监听 `iconic` 状态后隐藏，托盘恢复时重置扩展样式以兼容 Alt-Tab。
- 托盘能力基于 `pystray`/`Pillow`，优先使用仓库 `app.ico`，缺失时生成占位图避免崩溃。
- 日结与计费在 `maybe_rollover_day` 中以 `WORK_END` 为阈值，确保不重复结算并写入历史记录。
- 9:00 前不计入摸鱼收入，跨天锁屏保留起点以避免次日重复计费。
- 配置与数据文件迁移至用户数据目录（`APPDATA`/`~/.local/share`），启动时自动迁移旧路径数据。
- 系统能力仅在 Windows 启用，非 Windows 返回安全默认值并做工作时段边界校验。
- 下班后最后使用时间在主循环按空闲阈值记录到 `last_after_work_usage` 字段。

## 修改日志
- v0.1.x feature/refactor/bugfix: 托盘化与依赖补齐、18:00 日结与历史记录、历史记录合并进数据文件。
- v0.2.x feature/bugfix/refactor: 数据迁移到本地用户目录；托盘详情与趋势弹窗；计费/锁屏与窗口焦点修复；版本常量与历史写盘策略整理。
- v0.3.0 refactor: 拆分配置、存储、系统调用与 UI 逻辑模块，入口保持原有启动流程。
- v0.3.1 refactor: 优化 README 与 Anchor 文档结构说明，并补充远景规划与落地路径说明。
- v0.3.2 bugfix: 增强非 Windows 环境降级处理与配置时间边界校验，减少误判与异常配置影响。
- v0.4.0 feature: 记录每日下班后最后使用时间，详情展示近7天最晚使用时刻并优化信息层级。
- v0.4.1 bugfix: 增加单实例锁，避免重复启动多个进程。
- v0.4.2 refactor: 精简详情弹窗层级与排版，降低信息密度并统一视觉样式。
- v0.4.3 refactor: 详情弹窗移除概览标题，趋势日期去年份并合并展示实际下班时间。
- v0.4.4 refactor: 仅在有记录时显示下班时间，并突出最晚记录日期。
- v0.4.5 refactor: 简化修改日志并重构技术路径描述。
- v0.4.6 refactor: 优化右键菜单栏视觉样式与状态提示。
- v0.4.7 bugfix: 修正右键菜单项不兼容的 padding 参数导致的启动报错。
- v0.4.8 bugfix: 右键菜单点击后主动收起，修正焦点刷新与暂停文案同步问题。
- v0.4.9 bugfix: 菜单弹出后补齐焦点与激活项，修复首次左键选择无法收起问题。
- v0.4.10 feature: 详情页周末日期使用重点色高亮显示。
- v0.4.11 bugfix: 右键菜单打开时暂停置顶兜底，避免菜单被窗口抢焦点。
- v0.4.12 bugfix: 右键菜单收起时统一释放 grab，避免菜单操作与弹窗冲突。

## 理想规划
- 进军 Web3，成为摸鱼界的代币；当前实现的只是最适合落地的一个小功能。
- 阶段一（现实落地）：完善桌面端体验与数据可信度，打磨计费与统计，后续将持续优化人机交互和视觉。
- 阶段二（资产化雏形）：引入可验证的摸鱼积分与身份体系，支持可视化排行与成就。
- 阶段三（代币化演进）：探索链上发行与治理机制，建立摸鱼生态的激励与协作模式。
